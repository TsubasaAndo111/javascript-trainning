## クロスオリジンリクエストに制約が無かった場合、どのような問題が発生するか

- CSRF（クロスサイトリクエストフォージェリ）攻撃の容易化
  悪意あるサイトが、ユーザーの認証情報（Cookieやセッション）を利用して、別のサイトに対して勝手にリクエストを送信できる。
  例：ユーザーが銀行サイトにログイン中に、攻撃者のサイトを開くと、攻撃者が勝手に送金リクエストを送信。

- 情報漏洩（データの不正取得）
  制約がなければ、任意のサイトから他のサイトのAPIや機密情報を取得できてしまう。
  例：攻撃者のサイトが、ユーザーのブラウザを使って別ドメインの個人情報APIを呼び出し、レスポンスを盗む。

## クロスオリジンリクエストでメソッド(POST/GET)やリクエストの内容によって Preflight リクエストの有無が異なる理由

安全性と互換性を保つために、ブラウザが「安全なリクエスト」と「潜在的に危険なリクエスト」を区別しているから。

同一オリジンポリシーでは、リクエスト自体を送ることはできるため、副作用のあるリクエストに関してはPreflightを送って、リクエストを送信してもよいか確認する。

同一オリジンポリシーで制限しているのはリクエストを送った人がレスポンスを読むこと。

- 安全なリクエスト（Simple Request）
  以下の条件を満たす場合、Preflightは不要：

  メソッドが GET、HEAD、POST のいずれか

  ヘッダーが標準的なもの（Accept、Content-Type が application/x-www-form-urlencoded、multipart/form-data、text/plain）

  → これらは従来のフォーム送信と同等であり、Webの歴史的互換性を保つために安全とみなされる

- 危険なリクエスト（Non-simple Request）
  以下の場合、Preflightが必要：

  メソッドが PUT、DELETE など

  カスタムヘッダーを含む（例：Authorization）

  Content-Type が JSON (application/json) など非標準

  → これらはサーバー側に副作用を与える可能性が高く、事前にサーバーが許可しているか確認する必要があ。

メモ用：

Preflightの目的はブラウザが OPTIONS リクエストを送信し、サーバーが Access-Control-Allow-\* ヘッダーで許可を返すことで、実際のリクエストを送信しても安全かどうかを確認する。
